# InkLink - 法人向け/個人向けプラン実装完了

## 🎯 実装概要

InkLinkに**法人向けプラン**と**個人向けプラン**の2つの登録体系を実装しました。ユーザーは用途に応じて適切なプランを選択でき、複数の組織に同時に参加することも可能です。

---

## ✅ 完了した実装内容

### 1. データベーススキーマの更新

#### `organizations`テーブル
- `type`: 'business' または 'personal'
- `invite_code`: 招待コード（個人向けは8文字、法人向けは16文字）
- `is_open`: オープン参加可能か（個人向けのみ）

#### `user_organizations`テーブル（新規作成）
- ユーザーと組織の多対多関係をサポート
- `is_active`: 現在アクティブな組織を識別
- 複数組織への参加を可能に

#### マイグレーションスクリプト
- `db/migrations/001_add_organization_types.sql`: 既存DBへの適用用スクリプト

---

### 2. サインアップフローの分岐

#### 法人向けサインアップ (`/signup/business`)
- **特徴**: 
  - 会社名・組織名を入力
  - 管理者として登録
  - 招待リンクで他のメンバーを追加
- **セキュリティ**: 管理者による承認制
- **用途**: 企業・組織での使用

#### 個人向けサインアップ (`/signup/personal`)
- **特徴**:
  - グループ名を入力
  - 8文字の招待コードを自動生成
  - 参加コードを共有して気軽に招待
- **セキュリティ**: 参加コードを知っている人なら誰でも参加可能
- **用途**: 友達、勉強会、サークルなど

---

### 3. ランディングページの更新 (`/landing`)

#### 2つのプラン選択カード
- **法人向け**: 青系（シアン）のカラーリング
- **個人向け**: 緑系（ライム）のカラーリング
- それぞれの特徴を明確に説明

---

### 4. 個人向け機能

#### グループ作成 (`/signup/personal`)
- 8文字の招待コード自動生成（例: ABC12345）
- 作成後に招待コードを表示

#### グループ参加 (`/join`)
- 招待コードを入力してグループに参加
- ログイン不要の場合はアカウント作成を促す

---

### 5. 法人向け機能

#### 組織設定ページ (`/settings`)
- **管理者のみアクセス可能**
- 組織情報の表示
- 招待リンクの生成とコピー機能
- メンバー一覧の表示（名前、メール、役割）

#### 招待リンク機能 (`/invite/[token]`)
- 16文字の招待トークンを生成
- リンクをクリックした人は以下の選択肢：
  - ログインして参加
  - アカウント作成して参加

---

### 6. 複数組織参加のサポート

#### 組織切り替えUI
- ヘッダーにドロップダウンメニュー
- 2つ以上の組織に所属している場合のみ表示
- ワンクリックで組織を切り替え
- 現在の組織が視覚的に識別可能

#### データ分離
- `user_organizations.is_active`で現在の組織を管理
- 組織ごとに独立したメンバー、ステータス、通知

---

### 7. API Routes

#### 認証関連
- `/api/auth/signup/business` - 法人向けサインアップ
- `/api/auth/signup/personal` - 個人向けサインアップ
- `/api/auth/me` - ユーザープロフィール取得（所属組織情報含む）

#### ステータス関連
- `/api/status` (GET/POST) - ステータスの取得/更新
- `/api/status/custom` (POST) - カスタムステータスの更新

#### 組織関連
- `/api/organization/switch` (POST) - 組織切り替え
- `/api/organization/invite-link` (GET) - 招待リンク取得/生成
- `/api/organization/members` (GET) - メンバー一覧取得
- `/api/organization/invite/[token]` (GET) - 招待情報取得
- `/api/organization/join-by-invite` (POST) - 招待リンクで参加

#### グループ関連
- `/api/group/join` (POST) - 参加コードでグループ参加

---

## 🚀 使用フロー

### 法人向けプランの場合

1. **管理者がサインアップ** (`/signup/business`)
   - 会社名、担当者名、メール、パスワードを入力
   - 管理者として組織を作成

2. **招待リンクを取得** (`/settings`)
   - 設定ページで招待リンクをコピー

3. **メンバーを招待**
   - 招待リンクをメール、Slack、Teamsなどで共有
   - メンバーは `/invite/[token]` にアクセス

4. **メンバーがアカウント作成**
   - ログインまたはアカウント作成
   - 自動的に組織に参加

### 個人向けプランの場合

1. **グループを作成** (`/signup/personal`)
   - グループ名、名前、メール、パスワードを入力
   - 8文字の招待コードを取得

2. **友達を招待**
   - 招待コード（例: ABC12345）を共有
   - または `/join` ページのURLを共有

3. **友達がアカウント作成**
   - `/join` ページで招待コードを入力
   - または直接サインアップ後に招待コードを入力

---

## 🔧 今後の拡張可能性

### すぐに実装可能
- メール送信機能の統合（SendGrid, Resend, AWS SES）
- 招待リンクの有効期限設定
- 招待の承認/拒否フロー（法人向け）

### 将来的な拡張
- 部署・チーム機能（サブグループ）
- 詳細な権限管理（ビューアー、エディター、管理者）
- 組織間のコラボレーション機能
- プライベートメッセージ機能

---

## 📊 技術スタック

- **Frontend**: Next.js 14, TypeScript, Tailwind CSS
- **Backend**: Next.js API Routes
- **Database**: PostgreSQL 16 (ローカル開発) / Supabase (本番)
- **Authentication**: Supabase Auth
- **Styling**: Splatoon風のゲーミングデザイン

---

## 🎨 デザインの一貫性

- **法人向け**: シアン系カラー（`bg-cyan-400`）
- **個人向け**: ライム系カラー（`bg-lime-400`）
- **共通**: Splatoon風のインク飛び散りエフェクト、ネオングロー

---

## ✨ まとめ

**すべての実装が完了しました！**

InkLinkは、法人と個人の両方のニーズに対応できる柔軟なプラットフォームになりました。ユーザーは自分の用途に合わせてプランを選択でき、複数の組織やグループに同時に参加することも可能です。

次のステップとして、以下をお勧めします：
1. ローカルでデータベースマイグレーションを実行
2. 法人向けと個人向けの両方のサインアップフローをテスト
3. 招待機能のテスト
4. 組織切り替え機能のテスト

何か問題があればお知らせください！

